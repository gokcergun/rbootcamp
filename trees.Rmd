---
title: "Trees"
author: "Gökce Ergün"
date: "2/3/2021"
output: html_document
---
Hello world

Libraries that are used
```{r}
#install.packages('dplyr')
library(dplyr)
#install.package('lubridate')
library(lubridate)
#install.package('tidyr')
library(tidyr)
library(ggplot2)
```



Reading the data
```{r}
df_trees_orig <- read.csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-28/sf_trees.csv')

```

```{r}
df_trees <- df_trees_orig
```


Look at the data structure

```{r}
str(df_trees)
```
Changing columns with type character to type factor
```{r}

for (i in 1:12){ 
  if (is.character(df_trees[[i]]) == TRUE) {
    df_trees[[i]]<-as.factor(df_trees[[i]])
  }
  }

```


Check the percentage of missing values in each column

```{r}
for (col in colnames(df_trees)){
  print(paste(col, "=", mean(is.na(df_trees[[col]])))) #mean takes percentage here because adds up all TRUES (since their value is 1)
                                                       #and divides by total number of values (TRUE + FALSE)
}
```
checking if date data is missing at random or for particular species cohort.
```{r}
df_na_date <- df_trees %>% filter(is.na(date)) %>% 
  select(c(date, species))  
length(unique(df_na_date$species))

```

date column has char data type. We change it to date. 
```{r}
df_trees$date <- as.Date(df_trees$date,format="%Y-%m-%d")
```

```{r}
class(df_trees$date)
```


save the planted year of the tree as a separate column

```{r}
df_trees$year <- year(df_trees$date) ## year function is from lubridate package
class(df_trees$year)
```


```{r}
df_trees %>%
  select(year)%>%
  arrange() %>%
  head()
  
```
```{r}

df_trees <- df_trees %>% 
  mutate(age = year(Sys.Date())-year)


hist(df_trees$age, main = 'Tree Age Distribution', xlab = 'Age', col = 'royalblue2')


```



Get the number of unique species
```{r}
length(unique(df_trees$species))
```


```{r}
head(unique(df_trees$species))

```

Separate the species column into two
```{r}
df_trees <- df_trees %>% 
  separate(species, sep = "::", remove = FALSE, into = c('species_lat', 'species_nor'))
```



```{r}
length(unique(df_trees$species_lat))
length(unique(df_trees$species_nor))
```

Count the species

```{r}
df_trees %>%
  count(species_nor) %>%
  arrange(desc(n))
```



```{r}
df_trees %>%
  count(species_nor) %>%
  arrange(desc(n)) %>%
  top_n(n = 10)
```




Show number of distinct species in a street

```{r}
by_address <- df_trees %>%
  group_by(address) %>%
  summarize(n_distinct(species_lat))
```

